<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사건일 기반 도서 대출 횟수 비교</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:700,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/css.css">
    <link rel="stylesheet" href="/static/css/loanRankByDate.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://kit.fontawesome.com/2a2c9d90.js" crossorigin="anonymous"></script>
    <script src="/static/js/flyingBook.js"></script>
</head>
<body>
    <div class="navbar">
      <div class="nav-left">
        <div class="logo">Book Mate</div>
        <div class="nav-menu">
          <a href="/">Home</a>
          <a href="/pages/age/ageAnalysis.html">Book Trend</a>
          <a href="/loanRankByDate">Event Analysis</a>
        </div>
      </div>
      <div class="nav-right"></div>
    </div>
    <div class="main-content" style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:70vh;">
        <!-- 날짜 선택 버튼 -->
        <button type="button" id="calendarBtn" class="signup-btn" style="margin-bottom:1px; width:30%; font-size:1.25rem; display:flex; align-items:center; justify-content:center; gap:10px; padding:14px 0; border-radius:24px; box-shadow:0 2px 8px rgba(68, 68, 68, 0.06); margin-top:48px;">
            <i class="fa-solid fa-calendar-days"></i> &nbsp;날짜 직접 선택하기&nbsp;
        </button>
        <!-- 사건일 리스트 -->
        <div class="event-list-center" style="background:#fff; border-radius:18px; box-shadow:0 4px 24px rgba(126, 126, 126, 0.09); padding:48px 36px 56px 36px; min-width:350px; max-width:520px; width:100%; margin:0 auto; display:flex; flex-direction:column; align-items:center;">
            <div class="top6-title" style="text-align:center;color:#2d3057;font-size:1.25rem;font-weight:700;margin-bottom:24px;letter-spacing:0.5px; margin-top:12px;">조회수 TOP 6 사건일</div>
            <ul class="books-list" style="flex-direction:column;gap:18px;width:100%;">
                <% top6Dates.forEach((item, idx) => { %>
                    <li style="display:flex;align-items:center;gap:32px;background:#fff;border-radius:8px;padding:18px 20px;font-size:1.13rem;color:#222;font-weight:500;box-shadow:0 1px 6px rgba(160,89,255,0.04);">
                        <img src="<%= item.EVENT_THUMBNAIL_URL %>" alt="썸네일" style="width:112px;height:112px;object-fit:cover;border-radius:12px;box-shadow:0 1px 3px rgba(160,89,255,0.08);">
                        <div style="flex:1;">
                            <div class="event-title" style="font-weight:600;color:#2d3057;">
                                <%= idx+1 %>. 
                                <a href="/viewAnalysis?eventDate=<%= encodeURIComponent(item.EVENT_DATE) %>" style="color:#2d3057;text-decoration:none;">
                                    <%= item.EVENT_NAME %>
                                </a>
                            </div>
                            <div class="event-date" style="font-size:1.02rem;color:#888;"><%= item.EVENT_DATE %></div>
                        </div>
                        <span class="event-viewcount" style="font-size:1.08rem;color:#3e4a5b;white-space:nowrap;"><i class="fa-solid fa-eye"></i> <%= item.VIEW_COUNT %>회</span>
                    </li>
                <% }) %>
            </ul>
        </div>
        <!-- 달력 모달 -->
        <div id="calendarModal" class="modal-bg" style="display:none;position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:rgba(45,48,87,0.13);align-items:center;justify-content:center;">
            <form method="get" action="/viewAnalysis" style="background:#fff;border-radius:14px;box-shadow:0 8px 30px rgba(45,48,87,0.19);padding:32px 28px;min-width:320px;max-width:40vw;width:40vw;position:relative;display:flex;flex-direction:column;align-items:center;">
                <button id="modalCloseBtn" type="button" style="position:absolute;top:16px;right:16px;background:none;border:none;font-size:1.5rem;color:#888;cursor:pointer;"><i class="fa-solid fa-xmark"></i></button>
                <div style="width:100%;text-align:center;font-size:1.12rem;font-weight:600;color:#2d3057;margin-bottom:18px;">분석하고 싶은 날짜를 선택하세요.</div>
                <div id="calendar-inline"></div>
                <input type="hidden" id="eventDateInput" name="eventDate">
                <input type="submit" value="분석하기" class="signup-btn modal-submit-btn" style="width:120px; margin-top:18px;">
            </form>
        </div>
    </div>
    <style>
    .modal-submit-btn {
        background: #222 !important;
        color: #fff !important;
        border: none;
        border-radius: 20px;
        padding: 10px 0;
        font-size: 1.08rem;
        font-weight: bold;
        cursor: pointer;
        transition: background .2s;
    }
    .modal-submit-btn:hover {
        background: #ff9900 !important;
        color: #222 !important;
    }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 모달 관련
            const calendarBtn = document.getElementById('calendarBtn');
            const calendarModal = document.getElementById('calendarModal');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const eventDateInput = document.getElementById('eventDateInput');
            let fp = null;

            function openModal() {
                calendarModal.style.display = 'flex';
                if (!fp) {
                    fp = flatpickr("#calendar-inline", {
                        dateFormat: "Y-m-d",
                        maxDate: "2025-06-20",
                        minDate: "1970-01-01",
                        locale: "ko",
                        inline: true,
                        defaultDate: null,
                        onChange: function(selectedDates, dateStr) {
                            eventDateInput.value = dateStr;
                        }
                    });
                } else {
                    fp.setDate(null, false);
                }
            }
            calendarBtn.addEventListener('click', openModal);
            modalCloseBtn.addEventListener('click', function() {
                calendarModal.style.display = 'none';
            });
            calendarModal.addEventListener('click', function(e) {
                if (e.target === calendarModal) calendarModal.style.display = 'none';
            });
        });
    </script>
</body>
</html>